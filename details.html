<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Product Details</title>
<style>
  :root{
    --brand:#2b7a78;
    --bg:#eef3f7;
    --card:#fff;
    --max-w:520px;
  }
  html,body{height:100%;margin:0;}
  body{
    font-family:'Segoe UI', Roboto, Arial;
    background:var(--bg);
    padding:20px;
    display:flex;
    align-items:flex-start;
    justify-content:center;
  }

  .card{
    width:100%;
    max-width:var(--max-w);
    background:var(--card);
    padding:22px;
    border-radius:14px;
    box-shadow:0 6px 20px rgba(0,0,0,0.10);
    box-sizing:border-box;
  }

  .success-banner{
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
    padding: 14px;
    border-radius: 10px;
    text-align:center;
    font-weight:600;
    margin-bottom:16px;
  }

  h2{ margin:0 0 10px 0; color:#1d3557; font-size:1.2rem;}
  h3{ color:#264653; margin:14px 0 8px 0; font-size:1rem; }

  /* Accordion - premium responsive */
  .accordion {
    background: rgba(255,255,255,0.85);
    border-radius:12px;
    margin-top:14px;
    overflow:hidden;
    border-left:5px solid var(--brand);
    box-shadow:0 4px 14px rgba(0,0,0,0.06);
  }

  .accordion-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 16px;
    cursor:pointer;
  }

  .accordion-header h4{
    margin:0;
    font-size:16px;
    color:#133b5c;
  }

  .accordion-arrow{
    transition:transform .3s ease;
    font-size:18px;
    color:#0f4c5c;
  }

  .accordion.open .accordion-arrow{ transform: rotate(90deg); }

  .accordion-content{
    max-height:0;
    overflow:hidden;
    transition:max-height .35s ease, padding .25s ease;
    padding:0 16px;
    box-sizing:border-box;
  }

  .accordion.open .accordion-content{
    padding:12px 16px 16px;
    max-height:420px;
  }

  .accordion-content p{ margin:6px 0; color:#333; line-height:1.45; }

  label{display:block; margin-top:12px; color:#444; font-weight:600;}
  input[type="text"]{
    width:100%;
    padding:11px;
    border-radius:8px;
    border:1px solid #c9d6df;
    margin-top:8px;
    font-size:15px;
    box-sizing:border-box;
  }

  button{
    width:100%;
    padding:12px;
    margin-top:16px;
    background:var(--brand);
    color:#fff;
    border:none;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
    font-weight:700;
  }

  #status{ margin-top:12px; font-weight:600; color:#0a0a0a; }

  /* responsiveness tweaks */
  @media (max-width:420px){
    .card{ padding:16px; border-radius:12px; }
    h2{ font-size:1.1rem; }
    .accordion-header{ padding:12px; }
    .accordion-content{ padding-left:12px; padding-right:12px; }
    button{ padding:12px; font-size:15px; }
  }

  @media (min-width:1000px){
    :root{ --max-w:720px; }
    .card{ padding:28px; }
    h2{ font-size:1.35rem; }
  }
</style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="pageTitle">
    <div class="success-banner" id="banner">ðŸŽ‰ Congratulations! Your product is genuine and authenticated.</div>

    <h2 id="pageTitle">Product Authenticity Details</h2>
    <div id="info" aria-live="polite"></div>

    <!-- Accordions -->
    <div class="accordion" id="acc-warranty">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <h4>Warranty Information</h4><div class="accordion-arrow">â–¶</div>
      </div>
      <div class="accordion-content">
        <p><b>Type:</b> Limited Manufacturer Warranty</p>
        <p><b>Duration:</b> 12 Months from purchase date</p>
        <p>Covers manufacturing defects and quality issues.</p>
      </div>
    </div>

    <div class="accordion" id="acc-care">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <h4>Care Instructions</h4><div class="accordion-arrow">â–¶</div>
      </div>
      <div class="accordion-content">
        <p>â€¢ Store in a cool, dry place</p>
        <p>â€¢ Clean using a microfiber cloth</p>
        <p>â€¢ Avoid water, chemicals & drops</p>
        <p>â€¢ Do not self-repair or modify</p>
      </div>
    </div>

    <div class="accordion" id="acc-batch">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <h4>Factory Batch Information</h4><div class="accordion-arrow">â–¶</div>
      </div>
      <div class="accordion-content">
        <p><b>Inspection Level:</b> 4-step quality check</p>
        <p><b>QC Engineer:</b> Senior Quality Specialist</p>
        <p>Batch is certified before packaging.</p>
      </div>
    </div>

    <div class="accordion" id="acc-pack">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <h4>Packaging Authenticity</h4><div class="accordion-arrow">â–¶</div>
      </div>
      <div class="accordion-content">
        <p>âœ” Tamper-proof hologram</p>
        <p>âœ” Encrypted QR token (unclonable)</p>
        <p>âœ” Real-time scan traceability</p>
      </div>
    </div>

    <div class="accordion" id="acc-manuf">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <h4>Manufacturer Details</h4><div class="accordion-arrow">â–¶</div>
      </div>
      <div class="accordion-content">
        <p><b>Company:</b> SF Dynamix Industries Pvt. Ltd.</p>
        <p><b>HQ:</b> Bengaluru, India</p>
        <p><b>Plant:</b> Coimbatore, Tamil Nadu (ISO Certified)</p>
      </div>
    </div>

    <h3 style="margin-top:18px">Register Your Warranty</h3>
    <label for="custName">Name:</label>
    <input id="custName" type="text" placeholder="Enter your full name" />

    <label for="custPhone">Phone Number:</label>
    <input id="custPhone" type="text" placeholder="Enter your phone number"
      maxlength="10" inputmode="numeric"
      oninput="this.value=this.value.replace(/\\D/g,''); clearPhoneError();">
    <div id="phoneError" style="color:red; font-size:14px; margin-top:6px;"></div>

    <button id="saveBtn" onclick="saveCustomerDetails()">Save Details</button>
    <div id="status" role="status" aria-live="polite"></div>
  </main>

<script>
const sheetURL = "https://api.sheetbest.com/sheets/7b843d7a-47a4-406b-9555-28d60b46cd0c";
const params = new URLSearchParams(window.location.search);
const code = params.get("code");

// global matched record
let matchedRecord = null;

window.addEventListener('load', async () => {
  const infoDiv = document.getElementById('info');
  try {
    const response = await fetch(sheetURL);
    const data = await response.json();
    //matchedRecord = data.find(row => row.Code === code);
    matchedRecord = data.find(row => row.Code?.toLowerCase() === code.toLowerCase());

    if (!matchedRecord) {
      infoDiv.innerHTML = `<div style="color:#b00020;font-weight:600">Invalid Code</div>`;
      return;
    }

    infoDiv.innerHTML = `<p><b>Product:</b> ${matchedRecord.Product}</p><p><b>Code:</b> ${matchedRecord.Code}</p>`;
  } catch (e) {
    console.error(e);
    infoDiv.innerHTML = `<div style="color:#b00020;font-weight:600">Error loading product</div>`;
  }

  // make first accordion open on mobile for convenience
  const accs = document.querySelectorAll('.accordion');
  if(window.innerWidth <= 480 && accs.length) {
    accs[0].classList.add('open');
  }
});

// premium accordion toggle â€” ensures only one open at a time
function toggleAccordion(headerEl) {
  const parent = headerEl.parentElement;
  const all = document.querySelectorAll('.accordion');

  all.forEach(a => {
    if (a !== parent) a.classList.remove('open');
  });

  parent.classList.toggle('open');
}

function clearPhoneError() {
  document.getElementById("phoneError").textContent = "";
}

async function saveCustomerDetails(){
  const statusDiv = document.getElementById('status');
  const name = document.getElementById('custName').value.trim();
  const phone = document.getElementById('custPhone').value.trim();

  statusDiv.textContent = '';

  if(!name || !phone){
    statusDiv.innerHTML = `<span style="color:#b00020">Please fill all fields</span>`;
    return;
  }

  if (!/^[0-9]{10}$/.test(phone)) {
    document.getElementById("phoneError").textContent = "Enter a valid 10-digit phone number";
    return;
  }

  if(!matchedRecord){
    statusDiv.innerHTML = `<span style="color:#b00020">Product not loaded</span>`;
    return;
  }

  try {
    const payload = {
      CustomerName: name,
      CustomerPhone: phone
    };

    await fetch(`${sheetURL}/Code/${encodeURIComponent(code)}`, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    // redirect to thank you with safe query params
    const url = `thankyou.html?name=${encodeURIComponent(name)}&product=${encodeURIComponent(matchedRecord.Product)}&code=${encodeURIComponent(matchedRecord.Code)}`;
    window.location.href = url;
  } catch (e) {
    console.error(e);
    statusDiv.innerHTML = `<span style="color:#b00020">Error saving details. Try again.</span>`;
  }
}
</script>
</body>
</html>
