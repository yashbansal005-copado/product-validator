<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Product Details</title>

<style>
:root{
  --brand:#2b7a78;
  --bg:#eef3f7;
  --card:#fff;
  --max-w:520px;
}
html,body{height:100%;margin:0;}
body{
  font-family:'Segoe UI', Roboto, Arial;
  background:var(--bg);
  padding:20px;
  display:flex;
  align-items:flex-start;
  justify-content:center;
}

.card{
  width:100%;
  max-width:var(--max-w);
  background:var(--card);
  padding:22px;
  border-radius:14px;
  box-shadow:0 6px 20px rgba(0,0,0,0.10);
  box-sizing:border-box;
}

.success-banner{
  background:linear-gradient(135deg,#2ecc71,#27ae60);
  color:#fff;
  padding:14px;
  border-radius:10px;
  text-align:center;
  font-weight:600;
  margin-bottom:16px;
}

h2{margin:0 0 10px;color:#1d3557;font-size:1.2rem;}
h3{margin-top:18px;color:#264653;font-size:1rem;}

.accordion{
  background:rgba(255,255,255,0.85);
  border-radius:12px;
  margin-top:14px;
  overflow:hidden;
  border-left:5px solid var(--brand);
  box-shadow:0 4px 14px rgba(0,0,0,0.06);
}
.accordion-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px;
  cursor:pointer;
}
.accordion-header h4{
  margin:0;
  font-size:16px;
  color:#133b5c;
}
.accordion-arrow{
  transition:transform .3s ease;
  font-size:18px;
}
.accordion.open .accordion-arrow{transform:rotate(90deg);}
.accordion-content{
  max-height:0;
  overflow:hidden;
  transition:max-height .35s ease,padding .25s ease;
  padding:0 16px;
}
.accordion.open .accordion-content{
  padding:12px 16px 16px;
  max-height:420px;
}

label{display:block;margin-top:12px;font-weight:600;}
input{
  width:100%;
  padding:11px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #c9d6df;
}
button{
  width:100%;
  padding:12px;
  margin-top:16px;
  background:var(--brand);
  color:#fff;
  border:none;
  border-radius:8px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
}
#status{margin-top:12px;font-weight:600}
</style>
</head>

<body>
<main class="card">

  <div class="success-banner" id="banner">
    ðŸŽ‰ Congratulations! Your product is genuine and authenticated.
  </div>

  <h2>Product Authenticity Details</h2>
  <div id="info"></div>

  <!-- Accordions (unchanged content) -->
  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)">
      <h4>Warranty Information</h4><div class="accordion-arrow">â–¶</div>
    </div>
    <div class="accordion-content">
      <p><b>Type:</b> Limited Manufacturer Warranty</p>
      <p><b>Duration:</b> 12 Months</p>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)">
      <h4>Care Instructions</h4><div class="accordion-arrow">â–¶</div>
    </div>
    <div class="accordion-content">
      <p>â€¢ Store in cool dry place</p>
      <p>â€¢ Avoid water & chemicals</p>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)">
      <h4>Factory Batch Information</h4><div class="accordion-arrow">â–¶</div>
    </div>
    <div class="accordion-content">
      <p>Certified production batch</p>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)">
      <h4>Packaging Authenticity</h4><div class="accordion-arrow">â–¶</div>
    </div>
    <div class="accordion-content">
      <p>âœ” Tamper-proof QR</p>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion(this)">
      <h4>Manufacturer Details</h4><div class="accordion-arrow">â–¶</div>
    </div>
    <div class="accordion-content">
      <p>Track & Trace Pvt. Ltd.</p>
    </div>
  </div>

  <h3>Claim Your Prize</h3>

  <label>Name</label>
  <input id="custName" placeholder="Enter your full name"
    oninput="clearFormError()>

  <label>Phone Number</label>
  <input id="custPhone" maxlength="10" placeholder="Enter your phone number"
    oninput="this.value=this.value.replace(/\D/g,''); clearPhoneError(); clearPhoneError();">
  <div id="phoneError" style="color:red; font-size:14px; margin-top:6px;"></div>

  <button onclick="saveCustomer()">Save Details</button>
  <div id="status" role="status" aria-live="polite"></div>

</main>

<script>
const params = new URLSearchParams(location.search);
const enc = params.get("enc");
let productName = "";
let actualCode = "";
//loadProduct();
async function loadProduct(){
  const info = document.getElementById("info");
  try{
    const res = await fetch(
      "https://asia-south1-track-and-trace-native.cloudfunctions.net/checkClaim",
      {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({enc})
      }
    );
    const data = await res.json();

    productName = data.product;
    actualCode = data.code;

    info.innerHTML =
      `<p><b>Product:</b> ${productName}</p>
       <p><b>Code:</b> ${actualCode}</p>`;
  }catch{
    info.innerHTML="<span style='color:red'>Failed to load product</span>";
  }
}

function clearFormError() {
  const status = document.getElementById("status");
  status.textContent = "";
}

function clearPhoneError() {
  document.getElementById("phoneError").textContent = "";
}

function toggleAccordion(el){
  const acc = el.parentElement;
  document.querySelectorAll(".accordion").forEach(a=>{
    if(a!==acc) a.classList.remove("open");
  });
  acc.classList.toggle("open");
}

async function saveCustomer(){
  const name = custName.value.trim();
  const phone = custPhone.value.trim();
  const status = document.getElementById("status");

  /*if(!name || phone.length!==10){
    status.style.color="red";
    status.textContent="Enter valid details";
    return;
  }*/

  if(!name || !phone){
    status.innerHTML = `<span style="color:#b00020">Please fill all fields</span>`;
    return;
  }

  if (!/^[0-9]{10}$/.test(phone)) {
    document.getElementById("phoneError").textContent = "Enter a valid 10-digit phone number";
    return;
  }

  await fetch(
    "https://asia-south1-track-and-trace-native.cloudfunctions.net/saveCustomer",
    {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({enc,name,phone})
    }
  );

  window.location.href =
  `thankyou.html?enc=${encodeURIComponent(enc)}&name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}`;

}
</script>
</body>
</html>
