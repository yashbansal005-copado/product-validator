<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Product Details</title>

<style>
:root{
  --brand:#2b7a78;
  --bg:#eef3f7;
  --card:#fff;
  --max-w:520px;
}
html,body{height:100%;margin:0;}
body{
  font-family:'Segoe UI', Roboto, Arial;
  background:var(--bg);
  padding:20px;
  display:flex;
  align-items:flex-start;
  justify-content:center;
}

.card{
  width:100%;
  max-width:var(--max-w);
  background:var(--card);
  padding:22px;
  border-radius:14px;
  box-shadow:0 6px 20px rgba(0,0,0,0.10);
  box-sizing:border-box;
}

.success-banner{
  background:linear-gradient(135deg,#2ecc71,#27ae60);
  color:#fff;
  padding:14px;
  border-radius:10px;
  text-align:center;
  font-weight:600;
  margin-bottom:16px;
}

h2{margin:0 0 10px;color:#1d3557;font-size:1.2rem;}
h3{margin-top:18px;color:#264653;font-size:1rem;}

.accordion{
  background:rgba(255,255,255,0.85);
  border-radius:12px;
  margin-top:14px;
  overflow:hidden;
  border-left:5px solid var(--brand);
  box-shadow:0 4px 14px rgba(0,0,0,0.06);
}
.accordion-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px;
  cursor:pointer;
}
.accordion-header h4{
  margin:0;
  font-size:16px;
  color:#133b5c;
}
.accordion-arrow{
  transition:transform .3s ease;
  font-size:18px;
  color:#0f4c5c;
}
.accordion.open .accordion-arrow{transform:rotate(90deg);}
.accordion-content{
  max-height:0;
  overflow:hidden;
  transition:max-height .35s ease,padding .25s ease;
  padding:0 16px;
  box-sizing:border-box;
}
.accordion.open .accordion-content{
  padding:12px 16px 16px;
  max-height:420px;
}

.accordion-content p{ margin:6px 0; color:#333; line-height:1.45; }

label{display:block;margin-top:12px;font-weight:600;}
input{
  width:100%;
  padding:11px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #c9d6df;
}
button{
  width:100%;
  padding:12px;
  margin-top:16px;
  background:var(--brand);
  color:#fff;
  border:none;
  border-radius:8px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
}
#status{margin-top:12px;font-weight:600}
</style>
</head>

<body>
<main class="card" role="main" aria-labelledby="pageTitle">
    <div class="success-banner" id="banner">ðŸŽ‰ Congratulations! Your product is genuine and authenticated.</div>

    <h2 id="pageTitle">Product Authenticity Details</h2>
    <div id="info" aria-live="polite"></div>

  <!-- Accordions -->
    <div class="accordion" id="acc-warranty">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <h4>Warranty Information</h4><div class="accordion-arrow">â–¶</div>
      </div>
      <div class="accordion-content">
        <p><b>Type:</b> Limited Manufacturer Warranty</p>
        <p><b>Duration:</b> 12 Months from purchase date</p>
        <p>Covers manufacturing defects and quality issues.</p>
      </div>
    </div>

    <div class="accordion" id="acc-care">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <h4>Care Instructions</h4><div class="accordion-arrow">â–¶</div>
      </div>
      <div class="accordion-content">
        <p>â€¢ Store in a cool, dry place</p>
        <p>â€¢ Clean using a microfiber cloth</p>
        <p>â€¢ Avoid water, chemicals & drops</p>
        <p>â€¢ Do not self-repair or modify</p>
      </div>
    </div>

    <div class="accordion" id="acc-batch">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <h4>Factory Batch Information</h4><div class="accordion-arrow">â–¶</div>
      </div>
      <div class="accordion-content">
        <p><b>Inspection Level:</b> 4-step quality check</p>
        <p><b>QC Engineer:</b> Senior Quality Specialist</p>
        <p>Batch is certified before packaging.</p>
      </div>
    </div>

    <div class="accordion" id="acc-pack">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <h4>Packaging Authenticity</h4><div class="accordion-arrow">â–¶</div>
      </div>
      <div class="accordion-content">
        <p>âœ” Tamper-proof hologram</p>
        <p>âœ” Encrypted QR token (unclonable)</p>
        <p>âœ” Real-time scan traceability</p>
      </div>
    </div>

    <div class="accordion" id="acc-manuf">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <h4>Manufacturer Details</h4><div class="accordion-arrow">â–¶</div>
      </div>
      <div class="accordion-content">
        <p><b>Company:</b> SF Dynamix Industries Pvt. Ltd.</p>
        <p><b>HQ:</b> Bengaluru, India</p>
        <p><b>Plant:</b> Coimbatore, Tamil Nadu (ISO Certified)</p>
      </div>
    </div>

  <h3 style="margin-top:18px">Claim Your Prize after entering the below details..!!</h3>

  <label>Name</label>
  <input id="custName" placeholder="Enter your full name"/>

  <label>Phone Number</label>
  <input id="custPhone" maxlength="10" placeholder="Enter your phone number"/>
  <div id="phoneError" style="color:red; font-size:14px; margin-top:6px;"></div>

  <button onclick="saveCustomer()">Save Details</button>
  <div id="status" role="status" aria-live="polite"></div>

</main>

<script>
/*if (sessionStorage.getItem("FLOW_STEP") !== "DETAILS") {
  window.location.replace("../index.html");
}
sessionStorage.setItem("FLOW_STEP", "THANKYOU");
window.location.href = "thankyou/index.html" + location.search;*/

const params = new URLSearchParams(location.search);
const enc = params.get("enc");
//const originalCode = params.get("code");
//alert('enc and originalCode' + enc + '::' + originalCode);
let scratched = "";
let prize = "";
let productName = "";
let originalCode = "";

loadProduct();
async function loadProduct(){
  const info = document.getElementById("info");
  try{
    const res = await fetch(
      "https://asia-south1-track-and-trace-native.cloudfunctions.net/checkClaim",
      {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({enc})
      }
    );
    const data = await res.json();
    //alert('data: ' + JSON.stringify(data));
    scratched = data.scratched;
    prize = data.prize;
    productName = data.productName;
    originalCode = data.originalCode;
    info.innerHTML =
      `<p><b>Product:</b> ${productName}</p>
       <p><b>Code:</b> ${originalCode}</p>`;
  }catch{
    info.innerHTML="<span style='color:red'>Failed to load product</span>";
  }
}

/*function clearFormError() {
  const status = document.getElementById("status");
  status.textContent = "";
}

function clearPhoneError() {
  document.getElementById("phoneError").textContent = "";
}*/

const custName = document.getElementById("custName");
const custPhone = document.getElementById("custPhone");

custName.addEventListener("input", () => {
  clearFormError();
});

custPhone.addEventListener("input", () => {
  custPhone.value = custPhone.value.replace(/\D/g, "");
  clearFormError();
  clearPhoneError();
});

function clearFormError() {
  document.getElementById("status").textContent = "";
}

function clearPhoneError() {
  document.getElementById("phoneError").textContent = "";
}



function toggleAccordion(headerEl) {
  const parent = headerEl.parentElement;
  const all = document.querySelectorAll('.accordion');

  all.forEach(a => {
    if (a !== parent) a.classList.remove('open');
  });

  parent.classList.toggle('open');
}

async function saveCustomer(){
  const name = custName.value.trim();
  const phone = custPhone.value.trim();
  const status = document.getElementById("status");

  /*if(!name || phone.length!==10){
    status.style.color="red";
    status.textContent="Enter valid details";
    return;
  }*/

  if(!name || !phone){
    status.innerHTML = `<span style="color:#b00020">Please fill all fields</span>`;
    return;
  }

  if (!/^[0-9]{10}$/.test(phone)) {
    document.getElementById("phoneError").textContent = "Enter a valid 10-digit phone number";
    return;
  }

  await fetch(
    "https://asia-south1-track-and-trace-native.cloudfunctions.net/saveCustomer",
    {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({enc,name,phone})
    }
  );
  
  //sessionStorage.setItem("FLOW_STEP", "THANKYOU");
  window.location.href =
  `/thankyou/?enc=${encodeURIComponent(enc)}&name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}&originalCode=${encodeURIComponent(originalCode)}`;

}
</script>
</body>
</html>
